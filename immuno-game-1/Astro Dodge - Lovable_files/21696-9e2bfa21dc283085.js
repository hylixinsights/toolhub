try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="6d610dbd-cbfa-43a8-b181-f3de717827cc",e._sentryDebugIdIdentifier="sentry-dbid-6d610dbd-cbfa-43a8-b181-f3de717827cc")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[21696],{21696:(e,t,r)=>{r.d(t,{OJ:()=>h,Z2:()=>f,ZY:()=>p,QM:()=>v,XI:()=>y,Nm:()=>g});var n=r(20097),i=r(325413);let s=e=>(e=>"authenticated"===e.status||"authenticating"===e.status)(e)?e.user:null;var o=r(575945),a=r(628801),l=r(96324),u=r(968397),d=r(80115);let c=(0,i.createContext)(void 0);c.displayName="AuthContext";let f=()=>{let e=(0,i.useContext)(c);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e},h=e=>{let{user:t,children:r}=e,[f,h]=(0,i.useState)(null),g=(0,i.useRef)(void 0),p=(0,i.useRef)(t),v=(0,i.useRef)(null),y=(0,i.useRef)(!1);p.current=t;let m=(0,i.useCallback)(async()=>{l.logging.info("Session conflict detected during Firebase init, reloading"),(0,a.P7)(),window.location.assign("/?should-refresh-credentials=1")},[]);(0,i.useEffect)(()=>((async function(){try{if(!t)return void h({status:"unauthenticated"});g.current=t.uid,t.idToken&&o.tokenManager.setServerIdToken(t.idToken),h({status:"authenticating",user:t});let{auth:e}=await (0,a.n_)({shouldInitialize:!0,expectedUid:t.uid,onSessionConflict:m});v.current=e.onAuthStateChanged(e=>{if(e)if(p.current&&e.uid===p.current.uid){let t={status:"authenticated",user:p.current,firebaseUser:e};h(t)}else p.current&&e.uid!==p.current.uid?(l.logging.warn("AuthProvider: UID mismatch detected in onAuthStateChanged",{expectedUid:p.current.uid,actualUid:e.uid}),h({status:"unauthenticated"})):l.logging.warn("AuthProvider: Firebase user exists but no session user (unexpected)",{firebaseUid:e.uid});else{if(y.current||!p.current)return void h({status:"unauthenticated"});l.logging.warn("AuthProvider: Firebase session lost, keeping authenticated state",{userId:p.current.uid})}}),e.currentUser||l.logging.error("AuthProvider: Firebase init succeeded but no currentUser",{userId:t.uid})}catch(e){h({status:"error",error:{type:"initialization_failed",cause:e instanceof Error?e:Error(String(e))},partialUser:null!=t?t:void 0}),l.logging.error("AuthProvider: Failed to initialize Firebase",{error:e})}})(),()=>{var e;null==(e=v.current)||e.call(v)}),[t,m]),(0,i.useEffect)(()=>{let e=async()=>{var e;if("visible"===document.visibilityState&&g.current&&(await a.auth.authStateReady(),(null==(e=a.auth.currentUser)?void 0:e.uid)!==g.current)){let e=new URL(window.location.href);e.searchParams.set("should-refresh-credentials","1"),window.location.assign(e.toString())}};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[]);let x=(0,i.useCallback)(()=>{if((null==f?void 0:f.status)!=="authenticated")throw Error('requireAuth called but status is "'.concat(null==f?void 0:f.status,'". User must be authenticated to access this resource.'));return f},[f]),k=(0,i.useCallback)(async()=>{try{let e=await (0,d.$)();if(!e){let e={status:"unauthenticated"};return h(e),e}e.idToken&&o.tokenManager.setServerIdToken(e.idToken),g.current=e.uid,p.current=e,(0,a.P7)();let{auth:t}=await (0,a.n_)({serverCustomToken:e.customToken,shouldInitialize:!0,expectedUid:e.uid,onSessionConflict:m}),r=t.currentUser;if(!r){let t={status:"error",error:{type:"firebase_auth_failed",cause:Error("Refresh succeeded but no Firebase user")},partialUser:e};return h(t),t}let n={status:"authenticated",user:e,firebaseUser:r};return h(n),n}catch(t){let e={status:"error",error:{type:"initialization_failed",cause:t instanceof Error?t:Error(String(t))}};return h(e),l.logging.error("AuthProvider: Failed to refresh auth",{error:t}),e}},[m]),w=(0,i.useCallback)(async()=>{try{y.current=!0,await a.auth.signOut(),(0,a.P7)(),h({status:"unauthenticated"})}catch(e){throw l.logging.error("AuthProvider: Failed to sign out",{error:e}),e}finally{y.current=!1}},[]),b=(0,i.useMemo)(()=>({state:f,requireAuth:x,refresh:k,signOut:w,get authState(){if(!f)return"loading";switch(f.status){case"unauthenticated":return"idle";case"authenticating":return"loading";case"authenticated":return"authenticated";default:return"error"}},get authUser(){return f?s(f):null},get isAuthenticated(){return(null==f?void 0:f.status)==="authenticated"},get authError(){if((null==f?void 0:f.status)==="error"&&"cause"in f.error)return f.error.cause;return}}),[f,x,k,w]);return f?(0,n.jsx)(c.Provider,{value:b,children:r}):(0,n.jsx)(u.f,{})},g=()=>{var e,t;let{state:r}=f();return r&&null!=(t=null==(e=s(r))?void 0:e.email)?t:null},p=()=>{let{state:e}=f();return e?s(e):null},v=()=>{let{state:e}=f();return(null==e?void 0:e.status)==="authenticated"?e.firebaseUser:null},y=()=>{let{state:e}=f();return(null==e?void 0:e.status)==="authenticated"}},80115:(e,t,r)=>{r.d(t,{$:()=>l,ClientHydrationProvider:()=>u,S:()=>a});var n=r(20097),i=r(325413),s=r(968397);let o=(0,i.createContext)(null);function a(){let e=(0,i.useContext)(o);if(!e)throw Error("useHydration must be used within ClientHydrationProvider");return e}async function l(){for(let t=0;t<2;t++)try{var e;let t=await fetch("/api/auth/session");if(!t.ok)return null;return null!=(e=(await t.json()).user)?e:null}catch(e){0===t&&await new Promise(e=>setTimeout(e,500))}return null}function u(e){let{children:t,posthogBootstrapData:r,featureFlagBootstrapData:a}=e,[u,d]=(0,i.useState)({isHydrated:!1,authUser:null,posthogBootstrapData:r,featureFlagBootstrapData:a,panelSizes:null});(0,i.useEffect)(()=>{!async function(){let e=function(){if("undefined"==typeof localStorage)return null;try{let e=localStorage.getItem("panel-sizes");return e?JSON.parse(e):null}catch(e){return null}}(),t=await l();d(r=>({isHydrated:!0,authUser:t,posthogBootstrapData:r.posthogBootstrapData,featureFlagBootstrapData:r.featureFlagBootstrapData,panelSizes:e}))}()},[]);let c=!u.isHydrated;return(0,n.jsx)(o.Provider,{value:u,children:c?(0,n.jsx)(s.f,{}):t})}o.displayName="HydrationContext"},96324:(e,t,r)=>{r.r(t),r.d(t,{logging:()=>v,useLoggingStore:()=>g,wrapAsyncWithSpan:()=>m});var n=r(555432),i=r(513523),s=r(859668),o=r(273686),a=r(382017),l=r(602571),u=r(608366);let d={[u.$.LOG]:5,[u.$.TRACE]:4,[u.$.DEBUG]:3,[u.$.INFO]:2,[u.$.WARN]:1,[u.$.ERROR]:0},c=u.$.LOG;class f{static generateSessionId(){return(0,a.A)()}setSession(e){this._session={session_id:f.generateSessionId(),previous_session:this._session.session_id,project_id:e}}setUser(e){this._user=e}get session(){return this._session}get user(){return this._user}sessionForLogging(){let{session_id:e,...t}=this._session;return{session_id:e,...Object.fromEntries(Object.entries(t).filter(e=>{let[t,r]=e;return void 0!==r}).map(e=>{let[t,r]=e;return["session_attrs_".concat(t),r]}))}}userForLogging(){return Object.fromEntries(Object.entries(this._user||{}).filter(e=>{let[t,r]=e;return void 0!==r}).map(e=>{let[t,r]=e;return["user_".concat(t),r]}))}getForLogging(){return Object.fromEntries(Object.entries({...this.sessionForLogging(),...this.userForLogging()}).filter(e=>{let[t,r]=e;return void 0!==r}))}constructor(){this._session={session_id:f.generateSessionId()}}}let h=new f,g=(0,l.vt)(e=>({metadata:h,setMetadata:t=>e({metadata:t})}));function p(e,t){if(!(d[e]>d[c]))switch(e){case u.$.INFO:console.info(...t);break;case u.$.DEBUG:console.debug(...t);break;case u.$.TRACE:console.trace(...t);break;case u.$.WARN:console.warn(...t);break;case u.$.ERROR:console.error(...t);break;case u.$.LOG:console.log(...t)}}let v={info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];p(u.$.INFO,t)},debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];p(u.$.DEBUG,t)},trace:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];p(u.$.TRACE,t)},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];p(u.$.WARN,t)},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];p(u.$.ERROR,t)},log:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];p(u.$.LOG,t)}};async function y(e,t,r,a){var l;let u=null!=(l=null==a?void 0:a.tracer)?l:n.u.getTracer("gptengineer-app");if((null==a?void 0:a.requireParent)&&!n.u.getActiveSpan())return await Promise.resolve(r(null));let d=u.startSpan(e,{kind:i.v.INTERNAL,...t});try{let e=n.u.setSpan(s._.active(),d);return await s._.with(e,()=>Promise.resolve(r(d)))}catch(t){let e=t instanceof Error?t:Error(String(t));throw d.setStatus({code:o.s.ERROR,message:e.message}),d.recordException(e),t}finally{d.end()}}function m(e,t,r,n){return function(){for(var i=arguments.length,s=Array(i),o=0;o<i;o++)s[o]=arguments[o];return y(e,t,()=>Promise.resolve(r.apply(this,s)),n)}}},102626:(e,t,r)=>{let n,i;r.d(t,{C:()=>c,r:()=>d});var s=r(728866),o=r(400641),a=r(973912),l=r(543929);let u=!1;function d(){return n||(n=(0,s.Dk)().length>0?(0,s.Dk)()[0]:(0,s.Wp)(l.C)),n}function c(){return!i&&((i=(0,o.xI)(d())).useDeviceLanguage(),u||(0,a.Nu)()||(u=!0,(0,o.Qe)(i).catch(()=>{}))),i}},255483:(e,t,r)=>{r.d(t,{LovableLogoColor:()=>s});var n=r(20097),i=r(325413);let s=e=>{let t=(0,i.useId)(),r="".concat(t,"-mask"),s="".concat(t,"-filter0"),o="".concat(t,"-filter1"),a="".concat(t,"-filter2"),l="".concat(t,"-filter3"),u="".concat(t,"-gradient");return(0,n.jsxs)("svg",{viewBox:"0 0 23 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,n.jsx)("mask",{id:r,style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"23",height:"24",children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.89785 0C10.7074 0 13.7957 3.17898 13.7957 7.10046V9.79908H16.0913C19.9009 9.79908 22.9892 12.9781 22.9892 16.8995C22.9892 20.821 19.9009 24 16.0913 24H0V7.10046C0 3.17898 3.08827 0 6.89785 0Z",fill:"url(#".concat(u,")")})}),(0,n.jsxs)("g",{mask:"url(#".concat(r,")"),children:[(0,n.jsx)("g",{filter:"url(#".concat(s,")"),children:(0,n.jsx)("ellipse",{cx:"10.0844",cy:"12.8114",rx:"15.5619",ry:"15.9769",fill:"#4B73FF"})}),(0,n.jsx)("g",{filter:"url(#".concat(o,")"),children:(0,n.jsx)("ellipse",{cx:"11.7941",cy:"4.04332",rx:"19.9306",ry:"15.9769",fill:"#FF66F4"})}),(0,n.jsx)("g",{filter:"url(#".concat(a,")"),children:(0,n.jsx)("ellipse",{cx:"15.0451",cy:"1.037",rx:"15.5619",ry:"14.0311",fill:"#FF0105"})}),(0,n.jsx)("g",{filter:"url(#".concat(l,")"),children:(0,n.jsx)("ellipse",{cx:"12.071",cy:"4.03913",rx:"9.35889",ry:"9.60846",fill:"#FE7B02"})})]}),(0,n.jsxs)("defs",{children:[(0,n.jsxs)("filter",{id:s,x:"-12.6378",y:"-10.3257",width:"45.4442",height:"46.2743",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,n.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,n.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),(0,n.jsx)("feGaussianBlur",{stdDeviation:"3.58011",result:"effect1_foregroundBlur"})]}),(0,n.jsxs)("filter",{id:o,x:"-15.2967",y:"-19.0938",width:"54.1815",height:"46.2743",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,n.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,n.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),(0,n.jsx)("feGaussianBlur",{stdDeviation:"3.58011",result:"effect1_foregroundBlur"})]}),(0,n.jsxs)("filter",{id:a,x:"-7.67707",y:"-20.1544",width:"45.4442",height:"42.3827",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,n.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,n.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),(0,n.jsx)("feGaussianBlur",{stdDeviation:"3.58011",result:"effect1_foregroundBlur"})]}),(0,n.jsxs)("filter",{id:l,x:"-4.44806",y:"-12.7296",width:"33.0382",height:"33.5375",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,n.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,n.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),(0,n.jsx)("feGaussianBlur",{stdDeviation:"3.58011",result:"effect1_foregroundBlur"})]}),(0,n.jsxs)("linearGradient",{id:u,x1:"7.73627",y1:"4.21757",x2:"15.0724",y2:"23.8669",gradientUnits:"userSpaceOnUse",children:[(0,n.jsx)("stop",{offset:"0.025",stopColor:"#FF8E63"}),(0,n.jsx)("stop",{offset:"0.56",stopColor:"#FF7EB0"}),(0,n.jsx)("stop",{offset:"0.95",stopColor:"#4B73FF"})]})]})]})}},543929:(e,t,r)=>{r.d(t,{C:()=>n});let n=(0,r(973912).O_)()?{apiKey:"AIzaSyBQNjlw9Vp4tP4VVeANzyPJnqbG2wLbYPw",authDomain:"auth.lovable.dev",projectId:"gpt-engineer-390607",storageBucket:"gpt-engineer-390607.appspot.com",messagingSenderId:"288002387414",appId:"1:288002387414:web:231da37c38c486ca814877",measurementId:"G-EFZ8TB5QLN",clientEmail:"firebase-adminsdk-thfj5@gpt-engineer-390607.iam.gserviceaccount.com"}:{apiKey:"AIzaSyC8MAnZTLUBttWHlEIMl0u8gGI0R5oGnXU",authDomain:"gpt-engineer-dev.firebaseapp.com",projectId:"gpt-engineer-dev",storageBucket:"gpt-engineer-dev.appspot.com",messagingSenderId:"435422046193",appId:"1:435422046193:web:36e2c4049799e14110c650",clientEmail:"firebase-adminsdk-tg5bc@gpt-engineer-dev.iam.gserviceaccount.com"}},575945:(e,t,r)=>{r.d(t,{tokenManager:()=>h});var n=r(96324),i=r(704390);class s{get(e,t,r){let n=this.tokenByUserId[e],i=this.expirationByUserId[e];return n&&i?Date.now()/a+r>=i?t:n:t}set(e,t,r){this.tokenByUserId[e]=t,this.expirationByUserId[e]=r}clear(){this.tokenByUserId={},this.expirationByUserId={}}constructor(){this.tokenByUserId={},this.expirationByUserId={}}}let o=new s,a=1e3;async function l(e){var t,r,n,s,l;let{serverIdToken:u,refreshTokenUrl:d,checkRevoked:f}=e;if(!u)return null;let h=(0,i.i)(u),g=null!=(t=null==h?void 0:h.sub)?t:null==h?void 0:h.user_id;if(!g||"string"!=typeof g){let e=await c(d);if(!(null==e?void 0:e.idToken))throw Error("Refresh token endpoint returned invalid response. This URL should point to endpoint exposed by the middleware and configured using refreshTokenPath option");let t=(0,i.i)(e.idToken),s=null!=(r=null==t?void 0:t.sub)?r:null==t?void 0:t.user_id,a=null!=(n=null==t?void 0:t.exp)?n:0;return s&&"string"==typeof s&&o.set(s,e.idToken,a),e.idToken}let p=o.get(g,u,300),v=(0,i.i)(p),y=null!=(s=null==v?void 0:v.exp)?s:0,m=Date.now()/a;if(!f&&m+300<y)return p===u&&o.set(g,p,y),p;let x=await c(d);if(!(null==x?void 0:x.idToken))throw Error("Refresh token endpoint returned invalid response. This URL should point to endpoint exposed by the middleware and configured using refreshTokenPath option");let k=(0,i.i)(x.idToken),w=null!=(l=null==k?void 0:k.exp)?l:0;return o.set(g,x.idToken,w),x.idToken}async function u(e,t,r){var n;let i=await d(e);return Error("Internal request to ".concat(null!=(n=null==r?void 0:r.method)?n:"GET"," ").concat(t.toString()," has failed: ").concat(i))}function d(e){let t=e.headers.get("content-type");return t&&-1!==t.indexOf("application/json")?e.json():e.text()}async function c(e,t){let r=new Headers(null==t?void 0:t.headers);r.set("Accept","application/json"),r.set("Content-Type","application/json");let n=await fetch(e,{...t,headers:r});if(!n.ok)throw await u(n,e,t);return d(n)}class f{setServerIdToken(e){this.serverIdToken=e,this.initialized=!0}isInitialized(){return this.initialized}reset(){this.serverIdToken=null,this.refreshPromise=null,this.initialized=!1,o.clear()}async getValidToken(){if(!this.serverIdToken)return null;if(this.refreshPromise)return this.refreshPromise;try{this.refreshPromise=l({serverIdToken:this.serverIdToken,refreshTokenUrl:"/api/refresh-token"});let e=await this.refreshPromise;return this.refreshPromise=null,e}catch(e){return this.refreshPromise=null,n.logging.warn("TokenManager: token refresh failed",{error:e instanceof Error?e.message:String(e)}),null}}constructor(){this.serverIdToken=null,this.refreshPromise=null,this.initialized=!1}}let h=new f},608366:(e,t,r)=>{r.d(t,{$:()=>n});var n=function(e){return e.LOG="LOG",e.TRACE="TRACE",e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e}({})},628801:(e,t,r)=>{r.d(t,{Lf:()=>l,P7:()=>d,R1:()=>a,auth:()=>s,n_:()=>c});var n=r(400641),i=r(96324);let s=(0,r(102626).C)(),o=null;function a(e){o=e}function l(){if(!o)throw Error("Firestore not initialized - this should only be used on authenticated pages");return o}let u=!1,d=()=>{u=!1},c=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{shouldInitialize:t=!1,expectedUid:r,onSessionConflict:a,signal:l,serverCustomToken:d}=e;if(await s.authStateReady(),!u&&t){u=!0;let e=!1;if(s.currentUser&&r&&s.currentUser.uid===r)return{db:o,auth:s};let t=null!=d?d:null;if(!t)for(let r=0;r<5&&!t&&(null==l||!l.aborted)&&(r>0&&await new Promise(e=>setTimeout(e,1e3*r)),null==l||!l.aborted);r++)try{let r=await fetch("/api/auth/custom-token",{method:"POST",credentials:"include",signal:l});if(r.ok)t=(await r.json()).customToken,e=!1;else if(r.status>=400&&r.status<500){i.logging.warn("Custom token endpoint returned 4xx",{status:r.status});break}else e=!0,i.logging.warn("Custom token endpoint returned 5xx",{status:r.status})}catch(t){if((null==l?void 0:l.aborted)||t instanceof DOMException&&"AbortError"===t.name)break;e=!0,i.logging.error("Failed to fetch custom token (network error)",{error:t,attempt:r})}if(t)try{await (0,n.p)(s,t)}catch(e){i.logging.error("signInWithCustomToken failed",{error:e}),u=!1}else(null==l?void 0:l.aborted)||i.logging.error("No custom token available for Firebase auth"),u=!1;if(r&&a&&!(null==l?void 0:l.aborted)){let t=!s.currentUser||s.currentUser.uid!==r;if(t&&!e){var c,f;i.logging.warn("Session conflict unresolved - forcing logout",{cookieUid:r,firebaseUid:null!=(f=null==(c=s.currentUser)?void 0:c.uid)?f:null}),await a()}else t&&e&&i.logging.warn("Session conflict due to transient error - not logging out",{cookieUid:r})}}return{db:o,auth:s}}},968397:(e,t,r)=>{r.d(t,{f:()=>s});var n=r(20097),i=r(255483);function s(){return(0,n.jsx)("div",{className:"flex min-h-dvh items-center justify-center",children:(0,n.jsx)("div",{className:"flex flex-col items-center gap-4",children:(0,n.jsx)(i.LovableLogoColor,{className:"size-12 shrink-0"})})})}}}]);