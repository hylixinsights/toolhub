try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="7a4a999c-73c0-46a1-914b-6d0149c59247",e._sentryDebugIdIdentifier="sentry-dbid-7a4a999c-73c0-46a1-914b-6d0149c59247")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[80465],{70981:(e,t,l)=>{l.d(t,{A:()=>r});var n,a=l(325413);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)({}).hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e}).apply(null,arguments)}let r=function(e){return a.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},e),n||(n=a.createElement("path",{fill:"currentColor",d:"M19.25 10.75h-8.5v8.5H17A2.25 2.25 0 0 0 19.25 17zM4.75 17A2.25 2.25 0 0 0 7 19.25h2.25v-8.5h-4.5zm14.5-10A2.25 2.25 0 0 0 17 4.75h-6.25v4.5h8.5zM4.75 9.25h4.5v-4.5H7A2.25 2.25 0 0 0 4.75 7zm16 7.75A3.75 3.75 0 0 1 17 20.75H7A3.75 3.75 0 0 1 3.25 17V7A3.75 3.75 0 0 1 7 3.25h10A3.75 3.75 0 0 1 20.75 7z"})))}},86364:(e,t,l)=>{l.d(t,{A:()=>r});var n,a=l(325413);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)({}).hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e}).apply(null,arguments)}let r=function(e){return a.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 -960 960 960"},e),n||(n=a.createElement("path",{d:"m654-454-91 147q-8 13-22.5 10T522-314l-33-133-306 305q-9 9-21 9t-21-9-9-21 9-21l305-305-133-33q-14-4-17-18.5t10-22.5l147-92-12-172q-1-15 12.5-22t24.5 3l132 111 160-64q14-5 24 5t5 24l-65 160 111 132q10 11 3.5 24.5T827-441zM131-721q-5-5-5-11t5-11l46-46q5-5 11-5t11 5l45 45q5 5 5 11t-5 11l-46 46q-5 5-11 5t-11-5zm428 307 63-102 120 9-78-92 45-111-111 45-92-78 9 120-102 64 117 29zm163 283-46-46q-5-5-4.5-11t5.5-11l45-45q5-5 11-5t11 5l46 46q5 5 4.5 11t-5.5 11l-45 45q-5 5-11 5t-11-5M578-579"})))}},234752:(e,t,l)=>{l.d(t,{w:()=>a});var n=l(726172);let a=(0,l(780493).w)(n.A,"FileAudioIcon")},247269:(e,t,l)=>{l.d(t,{p:()=>a});var n=l(86364);let a=(0,l(780493).w)(n.A,"WandStarsIcon")},261719:(e,t,l)=>{l.d(t,{t:()=>p});var n=l(20097),a=l(427321),s=l(325413),r=l(388952),i=l(352168),o=l(154724),c=l(459931),d=l(275798),u=l(762296),h=l(375896),m=l(578508),f=l(313259),x=l(373924);let v=e=>{let{fileName:t}=e,l=(0,m.I3)(t);return(0,n.jsxs)("div",{className:"flex h-full w-full flex-row items-center justify-center gap-1 rounded-xl border bg-background/50 p-2 px-2 backdrop-blur-sm transition-all hover:bg-muted/50",children:[(0,n.jsx)("div",{className:"flex items-center justify-center p-1",children:(0,n.jsx)(d.$,{icon:l,className:"h-8 w-8 flex-shrink-0 text-muted-foreground/70 md:h-7 md:w-7"})}),(0,n.jsxs)("div",{className:"w-full min-w-0 gap-1 text-left",children:[(0,n.jsx)("div",{className:"truncate text-sm font-medium leading-tight md:text-xs",title:t,children:t}),(0,n.jsx)("div",{className:"truncate text-[12px] leading-tight text-muted-foreground",children:(0,m.QC)(t)})]})]})},p=e=>{let{file:t,onClick:l,onRemove:d,onReference:p,isReferenced:g,className:w,showRemoveButton:j=!0,showReferenceButton:b=!1,objectFit:y="cover"}=e,[N,k]=(0,s.useState)(!1),[A,C]=(0,s.useState)(!1),W=(0,u.A)("md"),z=(0,m.WP)(t.name),E=(0,m.ti)(t.name),P="image"===E&&!N,O="video"===E&&!A;return(0,n.jsx)("div",{className:(0,h.cn)("group/file-card relative h-full w-full shrink-0",w),children:(0,n.jsxs)("div",{className:"relative h-full w-full cursor-pointer",onClick:l,"aria-label":z,children:[P?(0,n.jsx)("div",{className:"h-full w-full",children:(0,n.jsx)(a.default,{src:t.url,alt:z,className:(0,h.cn)("h-full w-full rounded-lg border","contain"===y?"object-contain":"object-cover"),onError:()=>k(!0),fill:!0,unoptimized:!0})}):O?(0,n.jsx)("div",{className:"aspect-square h-full w-full",children:(0,n.jsx)("video",{src:t.url,className:(0,h.cn)("h-full w-full rounded-lg border","contain"===y?"object-contain":"object-cover"),muted:!0,playsInline:!0,loop:!0,preload:"metadata",onMouseEnter:e=>e.currentTarget.play().catch(()=>{}),onMouseLeave:e=>e.currentTarget.pause(),onError:()=>C(!0),children:"Your browser does not support the video tag."})}):(0,n.jsx)(v,{fileName:z}),t.uploading&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-background/90",children:(0,n.jsx)(o.o,{size:"small",className:"shrink-0 animate-spin text-muted-foreground"})}),j&&d&&(0,n.jsxs)(x.m_,{instant:!0,children:[(0,n.jsx)(x.k$,{asChild:!0,children:(0,n.jsx)(f.$,{variant:"flat",size:W?"sm":"xs",iconOnly:!0,rounded:!0,className:(0,h.cn)("absolute -right-1 -top-1 z-[10000] opacity-0 group-hover/file-card:opacity-100",W&&"opacity-100"),onClick:e=>{e.stopPropagation(),d()},children:(0,n.jsx)(c.P,{})})}),(0,n.jsxs)(x.ZI,{children:["Remove ",P?"image":O?"video":"file"]})]}),b&&p&&(0,n.jsxs)(x.m_,{instant:!0,children:[(0,n.jsx)(x.k$,{asChild:!0,children:(0,n.jsx)(f.$,{variant:"outline",size:W?"sm":"xs",iconOnly:!0,rounded:!0,className:(0,h.cn)("absolute -right-1 -top-1 z-[10000] opacity-0 group-hover/file-card:opacity-100",W&&"opacity-100"),onClick:e=>{e.stopPropagation(),p()},disabled:g,children:g?(0,n.jsx)(r.S,{}):(0,n.jsx)(i.A,{})})}),(0,n.jsx)(x.ZI,{children:"Reference"})]})]})})}},352168:(e,t,l)=>{l.d(t,{A:()=>a});var n=l(760877);let a=(0,l(780493).w)(n.A,"PaperclipIcon")},500089:(e,t,l)=>{l.d(t,{k:()=>o,z:()=>i});var n=l(470800),a=l(325413),s=l(951121),r=l(578508);let i=e=>{let[t,l]=(0,a.useState)(!1),r=(0,a.useCallback)(async()=>{if(e&&!t)try{let t=await fetch(e);if(!t.ok&&304!==t.status)throw Error("HTTP error! status: ".concat(t.status));let a=await t.blob();try{await navigator.clipboard.write([new ClipboardItem({[a.type]:a})])}catch(e){if("image/png"!==a.type&&"image/svg+xml"!==a.type){let e=new Image,t=URL.createObjectURL(a);try{await new Promise((l,n)=>{e.onload=l,e.onerror=n,e.src=t});let l=document.createElement("canvas");l.width=e.width,l.height=e.height;let n=l.getContext("2d");if(!n)throw Error("Failed to get canvas context");n.fillStyle="white",n.fillRect(0,0,l.width,l.height),n.drawImage(e,0,0);let a=await new Promise((e,t)=>{l.toBlob(l=>{l?e(l):t(Error("Failed to convert image to PNG"))},"image/png",1)});await navigator.clipboard.write([new ClipboardItem({"image/png":a})])}finally{URL.revokeObjectURL(t)}}else throw e}l(!0),n.Ay.capture("project:chat:image_copied",{image_type:a.type,image_size:a.size}),setTimeout(()=>{l(!1)},2e3)}catch(e){(0,s.Ni)("Failed to copy image")}},[e,t]);return{copied:t,handleCopy:r}},o=(e,t)=>(0,a.useCallback)(async()=>{if(e)try{let l=await fetch(e),a=await l.blob(),s=URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s),n.Ay.capture("project:chat:file_downloaded",{file_name:t,file_type:(0,r.QC)(t)})}catch(e){(0,s.Ni)("Failed to download file")}},[e,t])},557071:(e,t,l)=>{l.d(t,{A:()=>r});var n,a=l(325413);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)({}).hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e}).apply(null,arguments)}let r=function(e){return a.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},e),n||(n=a.createElement("path",{fill:"currentColor",d:"M15.47 15.47a.75.75 0 1 1 1.06 1.06L14.06 19l2.47 2.47a.75.75 0 1 1-1.06 1.06l-3-3a.75.75 0 0 1 0-1.06zm3 0a.75.75 0 0 1 1.06 0l3 3a.75.75 0 0 1 0 1.06l-3 3a.75.75 0 1 1-1.06-1.06L20.94 19l-2.47-2.47a.75.75 0 0 1 0-1.06M4.25 18V6A3.75 3.75 0 0 1 8 2.25h5c.199 0 .39.08.53.22l6 6c.14.14.22.331.22.53v3a.75.75 0 0 1-1.5 0V9.75H16A3.75 3.75 0 0 1 12.25 6V3.75H8A2.25 2.25 0 0 0 5.75 6v12A2.25 2.25 0 0 0 8 20.25h1a.75.75 0 0 1 0 1.5H8A3.75 3.75 0 0 1 4.25 18m9.5-12A2.25 2.25 0 0 0 16 8.25h1.19l-3.44-3.44z"})))}},578508:(e,t,l)=>{l.d(t,{AE:()=>p,D7:()=>v,I3:()=>y,QC:()=>b,WP:()=>j,Zo:()=>g,ti:()=>w,u:()=>f});var n=l(234752),a=l(848519),s=l(691809),r=l(992671),i=l(842055),o=l(750784),c=l(352168),d=l(760400),u=l(940994);let h=[".png",".jpg",".jpeg",".gif",".webp",".svg",".ico",".bmp"],m=[".mp4",".avi",".mov",".webm",".mkv",".flv",".wmv"],f=e=>{let t=e.toLowerCase();return h.some(e=>t.endsWith(e))},x=[".png",".jpg",".jpeg",".webp"],v=e=>{let t=e.toLowerCase();return x.some(e=>t.endsWith(e))},p=e=>{let t=e.toLowerCase();return m.some(e=>t.endsWith(e))},g=e=>f(e)||p(e),w=(e,t)=>f(e)?"image":p(e)?"video":t?"binary":"text",j=e=>e.split("/").pop()||e,b=e=>{let t=e.split(".");return t.length>1?t[t.length-1].toUpperCase():"FILE"},y=e=>{let t=e.toLowerCase();return t.endsWith(".pdf")||t.endsWith(".doc")||t.endsWith(".docx")||t.endsWith(".ppt")||t.endsWith(".pptx")||t.endsWith(".txt")||t.endsWith(".md")?s.d:t.endsWith(".csv")||t.endsWith(".xls")||t.endsWith(".xlsx")?d.K:t.endsWith(".js")||t.endsWith(".jsx")||t.endsWith(".ts")||t.endsWith(".tsx")||t.endsWith(".json")||t.endsWith(".xml")||t.endsWith(".gitignore")?a.b:t.endsWith(".html")||t.endsWith(".css")?u.a:t.endsWith(".zip")||t.endsWith(".rar")||t.endsWith(".7z")||t.endsWith(".tar")||t.endsWith(".gz")?r.j:t.endsWith(".mp4")||t.endsWith(".avi")||t.endsWith(".mov")||t.endsWith(".webm")||t.endsWith(".mkv")||t.endsWith(".flv")||t.endsWith(".wmv")?o._:t.endsWith(".mp3")||t.endsWith(".wav")||t.endsWith(".ogg")||t.endsWith(".m4a")||t.endsWith(".aac")||t.endsWith(".flac")||t.endsWith(".wma")?n.w:t.endsWith(".tiff")||t.endsWith(".jpg")||t.endsWith(".jpeg")||t.endsWith(".png")||t.endsWith(".gif")||t.endsWith(".bmp")||t.endsWith(".ico")||t.endsWith(".webp")||t.endsWith(".svg")?i.x:c.A}},696823:(e,t,l)=>{l.d(t,{A:()=>i});var n,a,s=l(325413);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)({}).hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e}).apply(null,arguments)}let i=function(e){return s.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},e),n||(n=s.createElement("path",{fill:"currentColor",d:"M14 18h-2v-2h2zM12 16h-2v-2h2zM14 14h-2v-2h2zM12 12h-2v-2h2z"})),a||(a=s.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M13 2.25c.199 0 .39.08.53.22l6 6c.14.14.22.331.22.53v9A3.75 3.75 0 0 1 16 21.75H8A3.75 3.75 0 0 1 4.25 18V6A3.75 3.75 0 0 1 8 2.25zm-5 1.5A2.25 2.25 0 0 0 5.75 6v12A2.25 2.25 0 0 0 8 20.25h2V18h2v2.25h4A2.25 2.25 0 0 0 18.25 18V9.75H16A3.75 3.75 0 0 1 12.25 6V3.75zM13.75 6A2.25 2.25 0 0 0 16 8.25h1.19l-3.44-3.44z",clipRule:"evenodd"})))}},726172:(e,t,l)=>{l.d(t,{A:()=>r});var n,a=l(325413);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)({}).hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e}).apply(null,arguments)}let r=function(e){return a.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},e),n||(n=a.createElement("path",{fill:"currentColor",d:"M18.25 20c0-.543-.619-1.25-1.75-1.25s-1.75.707-1.75 1.25.619 1.25 1.75 1.25 1.75-.707 1.75-1.25m-14-2V6A3.75 3.75 0 0 1 8 2.25h5c.199 0 .39.08.53.22l6 6A.75.75 0 0 1 19 9.75h-3A3.75 3.75 0 0 1 12.25 6V3.75H8A2.25 2.25 0 0 0 5.75 6v12A2.25 2.25 0 0 0 8 20.25h2a.75.75 0 0 1 0 1.5H8A3.75 3.75 0 0 1 4.25 18m15.5 2c0 1.666-1.62 2.75-3.25 2.75s-3.25-1.084-3.25-2.75 1.62-2.75 3.25-2.75a3.75 3.75 0 0 1 1.75.433V13a.75.75 0 0 1 1.166-.624l3 2a.75.75 0 1 1-.832 1.248l-1.834-1.223zm-6-14A2.25 2.25 0 0 0 16 8.25h1.19l-3.44-3.44z"})))}},732066:(e,t,l)=>{l.d(t,{A:()=>r});var n,a=l(325413);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)({}).hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e}).apply(null,arguments)}let r=function(e){return a.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 -960 960 960"},e),n||(n=a.createElement("path",{d:"m140-800 58 119q7.73 15.4 22.08 24.2Q234.44-648 251-648q32.5 0 49.25-27.46T303-732l-33-68h89l58 119q7.73 15.4 22.08 24.2Q453.44-648 470-648q32.5 0 49.25-27.46T522-732l-33-68h89l58 119q7.73 15.4 22.08 24.2Q672.44-648 689-648q32.5 0 49.25-27.46T741-732l-33-68h112q24 0 42 18t18 42v520q0 24-18 42t-42 18H140q-24 0-42-18t-18-42v-520q0-24 18-42t42-18m0 212v368h680v-368zm0 0v368z"})))}},750784:(e,t,l)=>{l.d(t,{_:()=>a});var n=l(732066);let a=(0,l(780493).w)(n.A,"MovieIcon")},760400:(e,t,l)=>{l.d(t,{K:()=>a});var n=l(70981);let a=(0,l(780493).w)(n.A,"TableIcon")},760877:(e,t,l)=>{l.d(t,{A:()=>r});var n,a=l(325413);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)({}).hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e}).apply(null,arguments)}let r=function(e){return a.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},e),n||(n=a.createElement("path",{fill:"currentColor",d:"M5.25 15V8a.75.75 0 0 1 1.5 0v7a5.25 5.25 0 1 0 10.5 0V7a3.25 3.25 0 0 0-6.5 0v8a1.25 1.25 0 1 0 2.5 0V8a.75.75 0 0 1 1.5 0v7a2.75 2.75 0 1 1-5.5 0V7a4.75 4.75 0 1 1 9.5 0v8a6.75 6.75 0 0 1-13.5 0"})))}},848519:(e,t,l)=>{l.d(t,{b:()=>a});var n=l(557071);let a=(0,l(780493).w)(n.A,"FileCodeIcon")},866091:(e,t,l)=>{l.d(t,{x:()=>Y});var n=l(20097),a=l(980451),s=l(325413),r=l(382017),i=l(480695),o=l(908399),c=l(608366),d=l(332986),u=l(375896),h=l(578508);let m=(0,s.createContext)(null);m.displayName="AssetReplacementContext";let f=()=>{let e=(0,s.useContext)(m);if(!e)throw Error("useAssetReplacement must be used within AssetReplacementProvider");return e},x=e=>{let{children:t}=e,[l,a]=(0,s.useState)(null),[r,i]=(0,s.useState)(!1),[o,c]=(0,s.useState)(!1),d=(0,s.useRef)(null),u=(0,s.useCallback)(e=>{d.current=e},[]),h=(0,s.useCallback)(()=>{var e;null==(e=d.current)||e.abort(),d.current=null,a(null),i(!1),c(!1)},[]);return(0,n.jsx)(m.Provider,{value:{replacedAsset:l,setReplacedAsset:a,isReplacingAsset:r,setIsReplacingAsset:i,isRevealingOriginalAsset:o,setRevealingOriginalAsset:c,resetAssetReplacement:h,registerAbortController:u},children:t})};var v=l(214749),p=l(571003),g=l(427321);let w=()=>{let{replacedAsset:e,isRevealingOriginalAsset:t}=f(),[l,a]=(0,s.useState)(!1);return e?(0,n.jsxs)("div",{className:"relative h-full overflow-hidden rounded-lg",children:[!l&&(0,n.jsx)(g.default,{src:e.url,alt:"",className:"opacity-0",onLoad:()=>a(!0),fill:!0,unoptimized:!0}),(0,n.jsx)(v.N,{children:l&&(0,n.jsx)(p.P.div,{className:"absolute inset-0 bg-background",initial:{clipPath:"inset(-4px -4px -4px 100%)"},animate:{clipPath:t?"inset(-4px -4px -4px 100%)":"inset(-4px -4px -4px 0%)"},transition:{duration:.3,ease:t?"linear":[.33,1,.68,1]},children:(0,n.jsx)(g.default,{src:e.url,alt:"".concat(e.fileName," (processed)"),className:"h-full w-full object-contain",fill:!0,unoptimized:!0})},"replaced-asset-overlay")})]}):null},j=(0,s.createContext)(null);j.displayName="AnnotationContext";let b=()=>{let e=(0,s.useContext)(j);if(!e)throw Error("useAnnotation must be used within AnnotationProvider");return e},y=e=>{let{children:t}=e,[l,a]=(0,s.useState)(!1),[r,i]=(0,s.useState)(!1),[o,c]=(0,s.useState)(null),d=(0,s.useRef)(null),u=(0,s.useCallback)(()=>{a(!0)},[]),h=(0,s.useCallback)(()=>{a(!1),c(null)},[]),m=(0,s.useCallback)(()=>{a(!1),i(!1),c(null),d.current=null},[]),f=(0,s.useCallback)(e=>{d.current=e},[]),x=(0,s.useCallback)(async()=>{d.current&&await d.current()},[]);return(0,n.jsx)(j.Provider,{value:{isAnnotating:l,isExportingAnnotation:r,annotationEditor:o,startAnnotating:u,cancelAnnotation:h,setAnnotationEditor:c,setIsExportingAnnotation:i,resetAnnotation:m,registerExportHandler:f,exportAnnotation:x},children:t})};var N=l(313259);let k=()=>{let{isExportingAnnotation:e,cancelAnnotation:t,exportAnnotation:l}=b();return(0,n.jsxs)("div",{className:"flex shrink-0 items-center gap-2",children:[(0,n.jsx)(N.$,{variant:"outline",onClick:t,disabled:e,className:"h-9",children:"Cancel"}),(0,n.jsx)(N.$,{onClick:l,loading:e,loadingText:"Saving...",className:"h-9",children:"Save"})]})},A=e=>{let{onAccept:t,onDiscard:l}=e,{replacedAsset:a,isRevealingOriginalAsset:s,setRevealingOriginalAsset:r}=f();return(0,n.jsxs)("div",{className:"flex shrink-0 items-center gap-2",children:[(0,n.jsx)(N.$,{variant:"outline",onPointerDown:()=>r(!0),onPointerUp:()=>r(!1),onPointerLeave:()=>r(!1),onPointerCancel:()=>r(!1),disabled:!a,className:"h-9 select-none",children:s?"Release to show after":"Hold to see before"}),(0,n.jsx)(N.$,{variant:"outline",onClick:l,className:"h-9",children:"Cancel"}),(0,n.jsx)(N.$,{onClick:t,className:"h-9",children:"Save"})]})};var C=l(534634),W=l(745784),z=l(68865),E=l(515845),P=l(154724),O=l(247269),R=l(568482),I=l(862021),L=l(500089),q=l(715429),S=l(951121),T=l(926206);let M=e=>{let{imageUrl:t,fileName:l,isUploading:a}=e,s=(0,I.aX)(R.TO.FileAnnotations),r=(0,I.aX)(R.TO.RemoveBackground),{isReplacingAsset:i}=f(),{startAnnotating:o}=b(),{removeBackground:c}=function(e){let{setIsReplacingAsset:t,setReplacedAsset:l,registerAbortController:n}=f(),a=(0,q.n)({mutationFn:async e=>{let{imageUrl:t,signal:l}=e;return(0,T.d0)().POST("/images/remove-background",{body:{imageUrl:t},signal:l})},onMutate:()=>{t(!0)},onSuccess:(e,t)=>{let{signal:n}=t;n.aborted||l({url:e.url,fileName:e.fileName})},onError:(e,t)=>{let{signal:l}=t;l.aborted||(0,S.Ni)(e)},onSettled:(e,l,n)=>{let{signal:a}=n;a.aborted||t(!1)}});return{removeBackground:()=>{let t=new AbortController;n(t),a.mutate({imageUrl:e,signal:t.signal})}}}(t),{copied:d,handleCopy:u}=(0,L.z)(t),m=r&&!a&&(0,h.D7)(l);return(0,n.jsxs)(n.Fragment,{children:[s&&(0,n.jsxs)(N.$,{variant:"outline",onClick:o,className:"h-8 px-2 sm:h-9 sm:px-3",children:[(0,n.jsx)(E.r,{size:"default",className:"shrink-0 sm:mr-2"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Annotate"})]}),(0,n.jsxs)(N.$,{variant:"outline",onClick:u,disabled:d,className:"h-8 px-2 sm:h-9 sm:px-3",children:[(0,n.jsx)(z.T,{size:"default",className:"shrink-0 sm:mr-2"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:d?"Copied!":"Copy"})]}),m&&(0,n.jsx)(N.$,{variant:"outline",onClick:c,disabled:i,className:"h-8 px-2 sm:h-9 sm:px-3",children:i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(P.o,{size:"small",className:"shrink-0 animate-spin sm:mr-2"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Removing..."})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(O.p,{size:"default",className:"shrink-0 sm:mr-2"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Remove background"})]})})]})},$=e=>{let{file:t,onClose:l}=e,a=(0,h.ti)(t.name),s=(0,L.k)(t.url,t.name);return(0,n.jsxs)("div",{className:"flex shrink-0 items-center gap-1 sm:gap-2",children:[(0,n.jsxs)(N.$,{variant:"outline",onClick:s,className:"h-8 px-2 sm:h-9 sm:px-3",children:[(0,n.jsx)(C.s,{size:"default",className:"shrink-0 sm:mr-2"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Download"})]}),"image"===a&&(0,n.jsx)(M,{imageUrl:t.url,fileName:t.name,isUploading:t.uploading}),(0,n.jsx)(N.$,{variant:"ghost",size:"sm",iconOnly:!0,onClick:l,"aria-label":"Close file viewer",className:"h-8 sm:h-9",children:(0,n.jsx)(W.u,{size:"default",className:"shrink-0"})})]})},U=e=>{let{isAnnotating:t,hasReplacedAsset:l,file:a,onClose:s,onAcceptReplacement:r,onDiscardReplacement:i}=e;return t?(0,n.jsx)(k,{}):l?(0,n.jsx)(A,{onAccept:r,onDiscard:i}):(0,n.jsx)($,{file:a,onClose:s})},_=e=>e<32&&9!==e&&10!==e&&13!==e,F=e=>{let{file:t,isOpen:l}=e,a=(0,h.WP)(t.name),r=(0,h.ti)(t.name),i=((e,t,l)=>{let[n,a]=(0,s.useState)({status:"idle"}),r="text"===t;return(0,s.useEffect)(()=>{if(!l)return void a({status:"idle"});r&&"idle"===n.status&&(async()=>{a({status:"loading"});try{let t=await fetch(e),l=await t.blob(),n=await l.slice(0,4096).arrayBuffer(),s=new Uint8Array(n);if((e=>{if(0===e.length)return!1;let t=0;for(let l=0;l<e.length;l++)_(e[l])&&t++;return t/e.length>.05})(s))a({status:"binary"});else if(l.size>1048576)a({status:"tooLarge"});else{let e=await l.text();a({status:"loaded",content:e})}}catch(e){a({status:"error",message:"Error loading file content"})}})()},[e,t,l,r,n.status]),n})(t.url,r,l);if("image"===r)return(0,n.jsx)("div",{className:"relative flex h-full items-center justify-center rounded-lg",children:(0,n.jsx)(g.default,{src:t.url,alt:a,className:"max-h-full max-w-full rounded-lg object-contain",fill:!0,unoptimized:!0})});if("video"===r)return(0,n.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,n.jsx)("video",{src:t.url,controls:!0,autoPlay:!0,muted:!0,className:"h-full w-full rounded-lg object-contain",children:"Your browser does not support the video tag."})});switch(i.status){case"loading":return(0,n.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,n.jsx)(P.o,{size:"large",className:"shrink-0 animate-spin"})});case"binary":{let e=(0,h.I3)(t.name);return(0,n.jsxs)("div",{className:"flex h-full flex-col items-center justify-center",children:[(0,n.jsx)(e,{className:"mb-4 h-16 w-16 shrink-0 text-muted-foreground/70"}),(0,n.jsx)("p",{className:"text-lg font-medium",children:"Preview unavailable"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Cannot display preview, but file is ready to use"})]})}case"tooLarge":{let e=(0,h.I3)(t.name);return(0,n.jsxs)("div",{className:"flex h-full flex-col items-center justify-center",children:[(0,n.jsx)(e,{className:"mb-4 h-16 w-16 shrink-0 text-muted-foreground/70"}),(0,n.jsx)("p",{className:"text-lg font-medium",children:"Large file upload"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Cannot display files over 1 MB, but file is ready to use"})]})}case"error":{let e=(0,h.I3)(t.name);return(0,n.jsxs)("div",{className:"flex h-full flex-col items-center justify-center",children:[(0,n.jsx)(e,{className:"mb-4 h-16 w-16 shrink-0 text-muted-foreground/70"}),(0,n.jsx)("p",{className:"text-lg font-medium",children:"Error loading file"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:i.message})]})}case"loaded":return(0,n.jsx)("pre",{className:"overflow-x-auto rounded-lg bg-muted p-4 text-sm",children:(0,n.jsx)("code",{children:i.content})});case"idle":return null}},V=e=>{let{fileName:t,actionHeader:l}=e;return l?(0,n.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col justify-center",children:[(0,n.jsx)("h2",{children:l.title}),(0,n.jsx)("p",{className:"text-sm leading-tight text-muted-foreground",children:l.subtitle})]}):(0,n.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col justify-center",children:[(0,n.jsx)("h2",{className:"w-full truncate text-lg font-medium leading-tight",children:t}),(0,n.jsx)("p",{className:"text-sm leading-tight text-muted-foreground",children:(e=>{let t=(0,h.ti)(e);return"image"===t?"Image":"video"===t?"Video":(0,h.QC)(e)})(t)})]})};var B=l(493970),H=l(50319);let D=e=>{let{direction:t,onClick:l,disabled:a}=e,s="previous"===t?B.Y:H.v;return(0,n.jsx)(N.$,{variant:"solid",rounded:!0,size:"md",iconOnly:!0,onClick:e=>{e.stopPropagation(),l()},disabled:a,"aria-label":"previous"===t?"Previous":"Next",children:(0,n.jsx)(s,{size:"default"})})},Q=(0,a.default)(async()=>(await Promise.all([l.e(22617),l.e(48265),l.e(49600),l.e(52433),l.e(52899),l.e(94088),l.e(33727),l.e(86709),l.e(60321),l.e(31759),l.e(41222)]).then(l.bind(l,241222))).AnnotationToolbar,{loadableGenerated:{webpack:()=>[241222]},ssr:!1}),G=(0,a.default)(async()=>(await Promise.all([l.e(74610),l.e(22617),l.e(48265),l.e(49600),l.e(52433),l.e(52899),l.e(94088),l.e(33727),l.e(86709),l.e(60321),l.e(31759),l.e(45730)]).then(l.bind(l,545730))).ImageAnnotationEditor,{loadableGenerated:{webpack:()=>[545730]},ssr:!1}),Z=e=>{let{file:t,isOpen:l,onClose:a,onNavigateToPrevious:m,onNavigateToNext:x}=e,v=(0,h.WP)(t.name),p=(0,h.ti)(t.name),g=(0,d.Uw)(e=>e.setImages),{replacedAsset:j,isReplacingAsset:y,resetAssetReplacement:N}=f(),k=!!j,{isAnnotating:A,annotationEditor:C,setAnnotationEditor:W,setIsExportingAnnotation:z,resetAnnotation:E,registerExportHandler:P}=b(),O=k||y||A;(0,s.useEffect)(()=>{l||(N(),E())},[l,N,E]),(0,s.useEffect)(()=>{P(async()=>{if(C){z(!0);try{let e=[...C.getCurrentPageShapeIds()],t=await C.toImage(e,{format:"png",background:!0});if(null==t?void 0:t.blob){let e=URL.createObjectURL(t.blob),l=v.replace(/\.[^.]+$/,""),n={id:(0,r.A)(),url:e,name:"annotated-".concat(l,".png"),uploading:!1,uploaded:!1};g(e=>[...e,n]),E(),a()}else(0,o.v)("Failed to export annotation: no blob returned",{error:Error("toImage returned no blob"),severity:c.$.ERROR}),z(!1)}catch(e){(0,o.v)("Failed to export annotation",{error:e,severity:c.$.ERROR}),z(!1)}}})},[C,v,g,a,z,E,P]),(0,s.useEffect)(()=>{if(!l)return;let e=e=>{"ArrowLeft"===e.key&&m&&!O?(e.preventDefault(),m()):"ArrowRight"===e.key&&x&&!O&&(e.preventDefault(),x())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l,m,x,O]);let R=(0,s.useCallback)(()=>{if(j){let e={id:(0,r.A)(),url:j.url,name:j.fileName,uploading:!1,uploaded:!1};g(t=>[...t,e]),a()}},[j,g,a]),I=!O&&(m||x);return(0,n.jsx)(i.lG,{open:l,onOpenChange:e=>!e&&a(),children:(0,n.jsxs)(i.Cf,{hideCloseButton:!0,className:"flex max-h-[85vh] w-[90vw] max-w-4xl flex-col gap-0 p-6 pt-4 md:max-w-4xl",children:[I&&(0,n.jsx)("div",{className:"absolute -left-16 top-1/2 hidden -translate-y-1/2 md:block",children:(0,n.jsx)(D,{direction:"previous",onClick:()=>null==m?void 0:m(),disabled:!m})}),(0,n.jsxs)("div",{className:"relative mb-4 flex h-12 w-full items-center justify-between gap-4",children:[(0,n.jsx)(V,{fileName:v,actionHeader:(e=>{let{isAnnotating:t,hasReplacedAsset:l}=e;return t?{title:"Annotate",subtitle:"Draw on the image"}:l?{title:"Background removed",subtitle:"Preview the result"}:void 0})({isAnnotating:A,hasReplacedAsset:k})}),A&&(0,n.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:(0,n.jsx)("div",{className:"pointer-events-auto",children:(0,n.jsx)(Q,{tldrawEditor:C})})}),(0,n.jsx)(U,{isAnnotating:A,hasReplacedAsset:k,file:t,onClose:a,onAcceptReplacement:R,onDiscardReplacement:N})]}),(0,n.jsx)("div",{className:(0,u.cn)("relative h-[calc(85vh-8rem)] outline-none","image"!==p&&"video"!==p&&"overflow-auto"),children:A?(0,n.jsx)(G,{imageUrl:t.url,onEditorReady:W}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(F,{file:t,isOpen:l}),k&&(0,n.jsx)("div",{className:"absolute inset-0",children:(0,n.jsx)(w,{})})]})}),I&&(0,n.jsx)("div",{className:"absolute -right-16 top-1/2 hidden -translate-y-1/2 md:block",children:(0,n.jsx)(D,{direction:"next",onClick:()=>null==x?void 0:x(),disabled:!x})})]})})},Y=e=>{let{file:t,isOpen:l,onClose:a,onNavigateToPrevious:s,onNavigateToNext:r}=e;return(0,n.jsx)(y,{children:(0,n.jsx)(x,{children:(0,n.jsx)(Z,{file:t,isOpen:l,onClose:a,onNavigateToPrevious:s,onNavigateToNext:r})})})}},992671:(e,t,l)=>{l.d(t,{j:()=>a});var n=l(696823);let a=(0,l(780493).w)(n.A,"FileZipIcon")}}]);