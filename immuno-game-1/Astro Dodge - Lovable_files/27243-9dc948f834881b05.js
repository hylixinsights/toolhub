try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},r=(new e.Error).stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="bf5cee34-af98-4e66-b182-0eb3507f54c4",e._sentryDebugIdIdentifier="sentry-dbid-bf5cee34-af98-4e66-b182-0eb3507f54c4")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27243,70917],{64013:(e,r,t)=>{t.d(r,{C7:()=>g,KL:()=>f,Q4:()=>s,SO:()=>c,gF:()=>u,nF:()=>d});var a=t(96324);let i="pending-referral-code",o="pending-affiliate-code",n=["9b2f05a1-0596-4140-840c-b4bf5edc7622","454d0a26-0255-4a8f-abe9-38b06f717035"];function l(e){return Date.now()-e>6048e5}function s(e){if(e&&""!==e.trim())try{let r={code:e.trim(),timestamp:Date.now()};localStorage.setItem(i,JSON.stringify(r))}catch(r){a.logging.error("Failed to store referral code",{error:r,code:e})}}function c(){try{let e,r=localStorage.getItem(i);if(!r)return null;try{e=JSON.parse(r)}catch(e){return a.logging.error("Failed to parse stored referral code, clearing corrupted data",{error:e}),localStorage.removeItem(i),null}if(!e||!e.code||!e.timestamp)return a.logging.error("Invalid referral code structure in storage, clearing",{parsed:e}),localStorage.removeItem(i),null;if(l(e.timestamp))return localStorage.removeItem(i),null;return e}catch(e){return a.logging.error("Error retrieving stored referral code",{error:e}),null}}function u(e,r){if(e.token)try{let t={timestamp:Date.now(),affiliate:e,campaignId:r};localStorage.setItem(o,JSON.stringify(t))}catch(r){a.logging.error("Failed to store affiliate code",{error:r,affiliateId:e.id})}}function d(e){return null!==e&&n.includes(e)}function g(){try{let e,r=localStorage.getItem(o);if(!r)return null;try{e=JSON.parse(r)}catch(e){return a.logging.error("Failed to parse stored affiliate code, clearing corrupted data",{error:e}),localStorage.removeItem(o),null}if(!e||!e.timestamp||!e.affiliate)return a.logging.error("Invalid affiliate code structure in storage, clearing",{parsed:e}),localStorage.removeItem(o),null;if(l(e.timestamp))return localStorage.removeItem(o),null;return e}catch(e){return a.logging.error("Error retrieving stored affiliate code",{error:e}),null}}function f(){try{localStorage.removeItem(i)}catch(e){a.logging.error("Failed to remove stored referral code",{error:e})}try{localStorage.removeItem(o)}catch(e){a.logging.error("Failed to remove stored affiliate code",{error:e})}}},127653:(e,r,t)=>{t.d(r,{r:()=>c,U:()=>u});var a=t(325413),i=t(426333);function o(e){if(e&&"object"==typeof e&&"__bridgeError"in e){let{__bridgeError:r,message:t,...a}=e;throw Object.assign(Error(t),a)}}var n=t(96324),l=t(213224);async function s(e){let r=await fetch("/api/auth/custom-token",{method:"POST",...e&&{headers:{"Content-Type":"application/json"},body:JSON.stringify({idToken:e})}});if(!r.ok)throw Error("Failed to get custom token");let{customToken:t}=await r.json();return t}async function c(e){return s(e)}function u(){let{getBridge:e,isAvailable:r}=(0,l.V)(),{isIOSApp:t}=(0,i.V)(),c=(0,a.useCallback)(async()=>{try{let r=await (0,l.a)(e,"signInWithGoogle"),t=await r.signInWithGoogle();return o(t),t}catch(e){throw n.logging.error("signInWithGoogle failed",{error:e}),e}},[e]),u=(0,a.useCallback)(async()=>{try{let r=await (0,l.a)(e,"signInWithGithub"),t=await r.signInWithGithub();if(o(t),!(null==t?void 0:t.idToken))throw Error("signInWithGithub returned without idToken");return t}catch(e){throw n.logging.error("signInWithGithub failed",{error:e}),e}},[e]),d=(0,a.useCallback)(async()=>{try{let r=await (0,l.a)(e,"signInWithApple"),t=await r.signInWithApple();if(o(t),!(null==t?void 0:t.idToken))throw Error("signInWithApple returned without idToken");return t}catch(e){throw n.logging.error("signInWithApple failed",{error:e}),e}},[e]),g=(0,a.useCallback)(async r=>(await (0,l.a)(e,"signInWithSSO")).signInWithSSO(r),[e]),f=(0,a.useCallback)(async(r,t)=>{let a=await (0,l.a)(e,"linkWithSSO");await a.linkWithSSO(r,t)},[e]),p=(0,a.useCallback)(async(r,t)=>{let a=await (0,l.a)(e,"reauthWithSSO");await a.reauthWithSSO(r,t)},[e]),h=(0,a.useCallback)(async(r,t)=>{let a=await (0,l.a)(e,"verifyMfaTotp"),i=await a.verifyMfaTotp(r,t);return o(i),i},[e]),m=(0,a.useCallback)(async r=>{let t=await (0,l.a)(e,"sendMfaPhoneCode"),a=await t.sendMfaPhoneCode(r);return o(a),a},[e]),w=(0,a.useCallback)(async(r,t)=>{let a=await (0,l.a)(e,"verifyMfaPhone"),i=await a.verifyMfaPhone(r,t);return o(i),i},[e]),y=(0,a.useCallback)(async()=>{let r=await (0,l.a)(e,"cancelMfa");await r.cancelMfa()},[e]),v=(0,a.useMemo)(()=>{if(r)return{signInWithSSO:e=>g(e),linkWithSSO:(e,r)=>f(e,r),reauthWithSSO:(e,r)=>p(e,r),getCustomToken:s}},[r,g,f,p]);return{isNativeAuthAvailable:r,isIOS:t,signInWithGoogle:c,signInWithGithub:u,signInWithApple:d,signInWithSSO:g,linkWithSSO:f,reauthWithSSO:p,verifyMfaTotp:h,sendMfaPhoneCode:m,verifyMfaPhone:w,cancelMfa:y,nativeAuth:v}}},155648:(e,r,t)=>{t.d(r,{A:()=>i,M:()=>a});var a=function(e){return e.EXISTING_USER_LOGIN="existingUserLogin",e.SIGNUP="signup",e.SEGMENTATION="segmentation",e}({}),i=function(e){return e.CLAIM_REWARD="claimReward",e.REMIX_PROJECT="remixProject",e.CREATE_PROJECT="createProject",e}({})},211921:(e,r,t)=>{t.d(r,{S:()=>i,U:()=>o});var a=t(973912);function i(e){let r=null==e?void 0:e.trim();if(!r||r.startsWith("//"))return"/";if(r.startsWith("/"))return r;try{if(new URL(r,window.location.origin).origin===window.location.origin||(0,a.Cu)())return r}catch(e){}return"/"}function o(e){return e?i(e):"/"}},372884:(e,r,t)=>{t.d(r,{g:()=>a});var a=function(e){return e.USER_UPLOAD="user_upload",e.IFRAME_SNAPSHOT="iframe_snapshot",e}({})},663521:(e,r,t)=>{t.d(r,{YG:()=>c,d3:()=>d,if:()=>s,o_:()=>g,ou:()=>u});var a=t(183031),i=t(926206),o=t(575945),n=t(96324),l=t(524107);let s=async e=>{let r=await e.getIdToken();return await fetch("/api/login",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}}),o.tokenManager.setServerIdToken(r),r},c=async e=>{await e.reload();let r=await e.getIdToken(!0);return await fetch("/api/login",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}}),o.tokenManager.setServerIdToken(r),r},u=async e=>{try{let r=(0,i.Pg)(),t=await r.post("/user/sso/join-workspaces");return n.logging.info("SSO workspace auto-join successful",e),t.workspace_id||null}catch(r){return n.logging.error("SSO workspace auto-join failed",{error:r,...e}),null}},d=async()=>{try{let e=(0,i.Pg)(),r=(0,l.D)();return(await e.post("/user/sso/check-registration",{tracking_data:r})).is_new_registration}catch(e){return n.logging.error("Failed to check SSO registration",{error:e}),!1}},g=e=>{var r,t;let o=(0,i.Pi)(),{data:n,isLoading:l,error:s}=(0,a.I)({queryKey:["sso-provider",e],queryFn:async()=>{let r=await o.post("/sso/check-sso-provider-id",{display_name_or_provider_id:e});return{provider:r.provider_id,displayName:r.display_name}}});return{isLoadingSSO:l,ssoError:s,ssoProviderId:null!=(r=null==n?void 0:n.provider)?r:e,ssoProviderDisplayName:null!=(t=null==n?void 0:n.displayName)?t:e}}},676337:(e,r,t)=>{t.d(r,{A:()=>a.A,M:()=>a.M});var a=t(155648)},695397:(e,r,t)=>{t.d(r,{I:()=>h});var a=t(400282),i=t(470800),o=t(325413),n=t(21696),l=t(611442),s=t(213224),c=t(575945),u=t(628801),d=t(926206),g=t(96324);async function f(e){let r,{getBridge:t,timeoutMs:a=5e3}=e,i=!1,o=new Promise(e=>{r=setTimeout(()=>{i=!0,e()},a)}),n=(async()=>{try{var e,r;let a=await t();if(!a)return;let i=(null==(e=a.isNativeMethodAvailable)?void 0:e.call(a,"deleteFcmToken"))?a.deleteFcmToken().catch(e=>{g.logging.warn("push_token_native_cleanup_failed",{error:e})}):Promise.resolve(),o=(null==(r=a.isNativeMethodAvailable)?void 0:r.call(a,"getDeviceId"))?a.getDeviceId().then(e=>{let{device_id:r}=e;return(0,d.Pg)().delete("/fcm/tokens/".concat(encodeURIComponent(r)))}).catch(e=>{g.logging.warn("push_token_backend_cleanup_failed",{error:e})}):Promise.resolve();await Promise.allSettled([i,o])}catch(e){g.logging.warn("push_token_cleanup_failed",{error:e})}})();try{await Promise.race([n,o])}finally{r&&clearTimeout(r)}i&&g.logging.warn("push_token_cleanup_timed_out",{timeout_ms:a})}let p=e=>{try{localStorage.removeItem(e)}catch(r){g.logging.error("failed_to_clear_localstorage_item",{key:e,error:r})}};function h(){let e=(0,a.useRouter)(),[r,t]=(0,o.useState)(!1),d=(0,o.useRef)(!1),{signOut:h}=(0,n.Z2)(),{getBridge:m,isAvailable:w}=(0,s.V)();return[(0,o.useCallback)(async r=>{if(!d.current){d.current=!0,t(!0);try{var a,o,n,s=null==(a=u.auth.currentUser)?void 0:a.uid;p("lovable-admin-override"),p("post-auth-action"),p("pendingPlanSelection"),p("pending-promotion-code"),p("linkedin-oauth-state"),p("supabaseOAuthNonce"),p("supabaseOAuthCodeVerifier"),p("githubOAuthNonce"),p("pendingRemixJob"),s&&p("hide_referral_banner_".concat(s));try{for(let e of Object.keys(localStorage))e.startsWith("integrationOAuth_")&&p(e)}catch(e){g.logging.error("failed_to_iterate_localstorage_keys",{error:e})}w&&await f({getBridge:m}),c.tokenManager.reset(),await h().catch(e=>g.logging.warn("auth_signout_failed",{error:e})),await fetch("/api/logout").catch(e=>g.logging.warn("logout_api_failed",{error:e})),l.queryClient.clear();try{i.Ay.reset(!0)}catch(e){}let t=null!=(o=null==r?void 0:r.redirectBehavior)?o:"soft",d=null!=(n=null==r?void 0:r.redirectTo)?n:"/?should-refresh-credentials=1";"none"===t?e.refresh():"hard"===t?window.location.assign(d):e.replace(d)}catch(e){g.logging.error("logout_failed",{error:e})}finally{d.current=!1,t(!1)}}},[h,e,w,m]),r]}},702468:(e,r,t)=>{t.d(r,{H:()=>f,h:()=>p});var a=t(183031),i=t(325413),o=t(879100),n=t(873298),l=t(951121),s=t(926206),c=t(96324),u=t(630298),d=t(64013);async function g(e){try{let r=(0,s.Pi)();return await r.post("/user/validate-referral-code",{code:e})}catch(e){return null}}let f=()=>{var e,r;let t=(0,i.useMemo)(()=>(0,d.SO)(),[]),n=(0,i.useMemo)(()=>(0,d.C7)(),[]),l=!!t,s=!!n,{data:c,isLoading:f}=(0,a.I)({queryKey:u.yw.validateCode(null!=(e=null==t?void 0:t.code)?e:""),queryFn:()=>{var e;return g(null!=(e=null==t?void 0:t.code)?e:"")},enabled:l,staleTime:3e5,retry:1});if(l&&(null==c?void 0:c.valid))return{bonusData:{type:"referral",code:t.code,credits:null!=(r=c.invitee_credits)?r:o.aM,ownerName:c.owner_name,grantsBonusCredits:!0},isLoading:!1};if(s&&!l){let e=(0,d.nF)(n.campaignId);return{bonusData:{type:"affiliate",code:n.affiliate.token,credits:10*!!e,grantsBonusCredits:e,affiliate:n.affiliate},isLoading:!1}}return{bonusData:null,isLoading:l&&f}},p=()=>{let{setIsSuccessfulReferral:e}=(0,n.P)();return(0,i.useCallback)(async r=>{let t=(0,d.SO)(),a=(0,d.C7)(),i=(0,s.Pi)(),o=await r.getIdToken(),n={"Content-Type":"application/json",Authorization:"Bearer ".concat(o)};if(t){c.logging.info("Applying referral signup bonus",{referralCode:t.code});try{await i.post("/user/referral-code/use",{referral_code:t.code},{headers:n}),c.logging.info("Referral code redeemed successfully",{referralCode:t.code}),e(),(0,d.KL)()}catch(r){let e=(0,l.yO)(r);c.logging.error("Failed to redeem referral code",{referralCode:t.code,status:e.status,message:e.message}),400===e.status&&(e.message=e.message||"Invalid referral code",e.details="Your sign-up will proceed without the referral bonus."),(0,l.Ni)(e)}return}if(a){c.logging.info("Applying affiliate signup bonus",{affiliateId:a.affiliate.id});try{await i.post("/user/affiliate-code/use",{affiliate_id:a.affiliate.id,affiliate_token:a.affiliate.token},{headers:n}),c.logging.info("Affiliate code redeemed successfully",{affiliateId:a.affiliate.id}),(0,d.KL)()}catch(r){let e=(0,l.yO)(r);c.logging.error("Failed to redeem affiliate code",{affiliateId:a.affiliate.id,status:e.status,message:e.message}),400===e.status&&(e.message=e.message||"Invalid affiliate code",e.details="Your sign-up will proceed without the affiliate bonus."),(0,l.Ni)(e)}}},[e])}},770917:(e,r,t)=>{t.d(r,{hw:()=>P,zg:()=>O});var a=t(134472),i=t(325413),o=t(834669),n=t(501269),l=t(96324),s=t(6442),c=t(470800),u=t(926206),d=t(433080),g=t(728277),f=t(630298),p=t(612466),h=t(372884),m=t(640715),w=t(951121),y=t(816232),v=t(155648);let _=async(e,r,t)=>{try{let a=(0,u.Pg)();await a.post("/workspaces/".concat(e,"/campaigns/").concat(r,"/redeem/").concat(t)),c.Ay.capture(y.yx.REWARD.REDEEMED,{campaign:r,reward_code:t,workspace_id:e});return}catch(i){let a;throw l.logging.error("Failed to redeem campaign reward",{error:i,workspaceId:e,campaignName:r,rewardCode:t}),a=i instanceof Error?i:Error("Unknown error occurred while redeeming reward",{cause:i}),c.Ay.capture(y.yx.REWARD.REDEEM_FAILED,{campaign:r,reward_code:t,workspace_id:e,error_message:a.message}),a}},k={key:v.A.CLAIM_REWARD,paramsSchema:s.Ikc({campaignId:s.YjP().regex(/^[a-zA-Z0-9-]+$/),rewardCode:s.YjP().regex(/^[a-zA-Z0-9-]+$/)}),execute:async(e,r)=>{let{campaignId:t,rewardCode:a}=e,{workspaces:i,selectedWorkspaceId:o}=r,n=o;return(!n&&i&&i.length>0&&(n=(e=>{if(1===e.length){let r=e[0],{isPaidPlan:t}=(0,d.cb)(r.plan);if(!t)return r.id}return null})(i)),n)?(await _(n,t,a),{redirectUrl:"/?change_type=upgrade&payment_status=success",invalidateQueries:[f.workspaceKeys.all],workspaceUpdate:{workspaceId:n,updates:{plan:g.VL.KTLO}}}):{redirectUrl:"/lp/".concat(t,"?reward_code=").concat(a)}}},S=[k,{key:v.A.REMIX_PROJECT,paramsSchema:s.Ikc({projectId:s.YjP().regex(/^[a-zA-Z0-9_-]+$/),initialMessage:s.Ikc({id:s.YjP(),message:s.YjP(),files:s.YOg(s.Ikc({file_id:s.YjP(),type:s.fc(h.g),file_name:s.YjP().optional(),mime_type:s.YjP().optional()})).optional(),selected_elements:s.YOg(s.bzn()).length(0),chat_only:s.zMY().optional()}).optional()}),execute:async(e,r)=>{let{projectId:t}=e,{workspaces:a,selectedWorkspaceId:i}=r;try{var o;let r,n=(0,u.Pg)(),s=0;for(;s<3;)try{r=await n.get("/permissions?projectId=".concat(t));break}catch(e){if(++s>=3)return l.logging.error("Failed to fetch permissions after retries",{error:e,projectId:t,retries:s}),{redirectUrl:"/projects/".concat(t)};await new Promise(e=>setTimeout(e,1e3*s))}let c=r.includes(m.eZ.EditProject),d=r.includes(m.eZ.RemixProject);if(c)return{redirectUrl:"/projects/".concat(t)};if(!d)return{redirectUrl:"/"};let g=i||(null==a||null==(o=a[0])?void 0:o.id);if(!g)return l.logging.error("No workspace available for remix",{projectId:t}),{redirectUrl:"/"};let p=await n.get("/projects/".concat(t,"/details")),h=p.display_name||p.name||t,w={include_history:!1,include_custom_knowledge:!1,workspace_id:g,initial_message:e.initialMessage},y=await n.post("/projects/".concat(t,"/remix/init"),w);return localStorage.setItem("pendingRemixJob",JSON.stringify({jobId:y.job_id,projectId:t,projectName:h,timestamp:Date.now()})),{redirectUrl:"/",invalidateQueries:[f.gO.all]}}catch(e){return l.logging.error("Failed to execute remix project action",{error:e,projectId:t}),(0,w.Ni)(e),{redirectUrl:"/projects/".concat(t)}}}},{key:v.A.CREATE_PROJECT,paramsSchema:s.Ikc({message:s.YjP(),messageId:s.YjP(),chatModeEnabled:s.zMY().optional(),techStack:s.YjP().optional(),templateId:s.YjP().optional()}),execute:async(e,r)=>{let{message:t,messageId:a,chatModeEnabled:i,techStack:o,templateId:n}=e,{workspaces:s,selectedWorkspaceId:d}=r;try{var g;let e=(0,u.Pg)(),r=d||(null==s||null==(g=s[0])?void 0:g.id);if(!r)return l.logging.error("No workspace available for project creation"),{redirectUrl:"/"};c.Ay.capture("project:creation:post_auth_started",{source:"post_auth_action",chat_mode_enabled:i});let h={};void 0!==i&&(h.chat_mode_enabled=i),i&&(h.fullscreen_enabled=!0);let m={description:t,visibility:p.Lu.Private,metadata:h,initial_message:{id:a,message:t,chat_only:null!=i&&i,agent_mode_enabled:!1}};o&&(m.tech_stack=o),n&&(m.template_project_id=n);let w=await e.post("/workspaces/".concat(r,"/projects"),m);return{redirectUrl:"/projects/".concat(w.id),invalidateQueries:[f.workspaceKeys.all],queryDataToSet:[{queryKey:f.gO.initialPrompt(w.id),data:{id:a,message:t,images:[],chatOnly:i}}]}}catch(e){throw l.logging.error("Failed to execute create project action",{error:e}),(0,w.Ni)(e),e}}}],I=new Map;S.forEach(e=>{I.set(e.key,e)}),Object.fromEntries(S.map(e=>[e.key,e.paramsSchema]));let b=s.gMt("key",S.map(e=>{let r,t;return r=e.key,t=e.paramsSchema,s.Ikc({key:s.euz(r),params:t.optional(),contexts:s.YOg(s.fc(v.M)),timestamp:s.aig().optional()})})),P="post-auth-action";function E(e){if(!e)return null;try{let r=JSON.parse(e),t=b.safeParse(r);if(!t.success)return null;return t.data}catch(e){return null}}let O=()=>{let e=(0,a.jE)(),{userData:r}=(0,o.u)(),t=(0,n.k9)(),{workspaces:s}=(0,n.Mu)(e=>({workspaces:e.workspaces})),c=(0,i.useCallback)((e,r,t)=>{try{let a={key:e,params:r,contexts:t,timestamp:Date.now()},i=I.get(e);if(!i)return void l.logging.error("Unknown post-auth action",{actionKey:e,availableActions:Array.from(I.keys())});let o=i.paramsSchema.safeParse(r);if(!o.success)return void l.logging.error("Invalid params for post-auth action",{actionKey:e,params:r,error:o.error});localStorage.setItem(P,JSON.stringify(a))}catch(r){l.logging.error("Failed to store post-auth action",{error:r,actionKey:e})}},[]),u=(0,i.useCallback)(async(a,i,o)=>{let n=I.get(a);if(!n)return l.logging.error("Unknown post-auth action",{actionKey:a,availableActions:Array.from(I.keys())}),"/";let c=n.paramsSchema.safeParse(i);if(!c.success)return l.logging.error("Invalid params for post-auth action",{actionKey:a,params:i,error:c.error}),"/";let u={userId:null==r?void 0:r.id,workspaces:s,...o},d=await n.execute(c.data,u);if(d.workspaceUpdate&&(null==t?void 0:t.store)){let e=t.store.getState().workspaces.map(e=>e.id===d.workspaceUpdate.workspaceId?{...e,...d.workspaceUpdate.updates}:e);t.store.setState({workspaces:e})}return d.queryDataToSet&&d.queryDataToSet.length>0&&d.queryDataToSet.forEach(r=>{let{queryKey:t,data:a}=r;e.setQueryData(t,a)}),d.invalidateQueries&&d.invalidateQueries.length>0&&setTimeout(()=>{d.invalidateQueries.forEach(r=>{e.invalidateQueries({queryKey:r})})},2e3),d.redirectUrl||"/"},[e,r,t,s]);return{storeAction:c,executeStoredAction:(0,i.useCallback)(async()=>{try{let e=localStorage.getItem(P),r=E(e);if(!r)return e&&(l.logging.error("Invalid stored action"),localStorage.removeItem(P)),null;if(function(e){return!!e&&Date.now()-e>864e5}(r.timestamp))return localStorage.removeItem(P),null;let t=await u(r.key,r.params);return localStorage.removeItem(P),t}catch(e){if(localStorage.removeItem(P),l.logging.error("Failed to execute stored action",{error:e}),e instanceof Error)throw e;throw Error("Unknown error occurred while executing stored action",{cause:e})}},[u]),executeAction:u,shouldRunAction:(0,i.useCallback)(e=>{try{let r=localStorage.getItem(P),t=E(r);if(!t)return r&&localStorage.removeItem(P),!1;return t.contexts.includes(e)}catch(r){return l.logging.error("Failed to check if action should run",{error:r,context:e}),!1}},[])}}},855736:(e,r,t)=>{t.d(r,{bU:()=>p,Vy:()=>f,lq:()=>g});var a=t(400282),i=t(325413),o=t(770917),n=t(951121),l=t(926206);t(628801);var s=t(96324),c=t(676337),u=t(211921);let d="pending-collaboration-invite",g=()=>{let[e,r]=(0,i.useState)(null);return(0,i.useEffect)(()=>{try{let e=sessionStorage.getItem(d);if(e){let t=JSON.parse(e);r(t)}}catch(e){s.logging.error("Error reading pending collaboration invite:",{error:e})}},[]),{pendingInvite:e,clearPendingInvite:(0,i.useCallback)(()=>{sessionStorage.removeItem(d),r(null)},[])}},f=()=>{let e=(0,a.useSearchParams)(),{pendingInvite:r,clearPendingInvite:t}=g(),{shouldRunAction:n}=(0,o.zg)(),l=(0,i.useRef)(!1);return(0,i.useCallback)((a,i)=>{if(l.current)return;if(l.current=!0,n(c.M.EXISTING_USER_LOGIN)){window.location.href="/auth/post-login";return}if(r){let e="".concat(r.projectUrl,"?magic_link=").concat(r.magicLink);t(),window.location.href=e;return}let{url:o,isExternal:s}=(e=>{let r=null==e?void 0:e.get("redirect"),t=(0,u.S)(r||"/");if(t.startsWith("http://")||t.startsWith("https://"))return{url:t,isExternal:!0};let a=new URL(t,window.location.origin);return a.searchParams.set("should-refresh-credentials","1"),{url:a.pathname+a.search,isExternal:!1}})(e),d=new URLSearchParams(e);if(a){if((null==i?void 0:i.preserveRedirect)===!1?(d.delete("redirect"),d.set("should-refresh-credentials","1")):d.set("redirect",o),a.includes("?")){window.location.href=a+"&".concat(d.toString());return}window.location.href=a+"?".concat(d.toString());return}if(s){window.location.href=o;return}window.location.href=o},[e,r,t,n])},p=()=>{let[e,r]=(0,i.useState)(!1),[t,a]=(0,i.useState)(null);return{checkAuthProvider:(0,i.useCallback)(async e=>{if(!e||!e.includes("@"))return a(null),null;r(!0);try{let r=(0,l.Pi)(),t=await r.post("/auth/check-auth-provider",{email:e}),i={hasSSOProvider:t.has_sso_provider,ssoProviderID:t.sso_provider_id,ssoDisplayName:t.sso_display_name,ssoProviders:t.sso_providers,workspaceID:t.workspace_id,firebaseProviders:t.firebase_providers||[],hasEmailPassword:t.has_email_password,recommendedProvider:t.recommended_provider};return a(i),i}catch(r){console.error("Error checking auth provider:",r),(0,n.Ni)({message:"Unable to verify your account settings",details:"You can still sign in with your email and password.",status:500});let e={hasSSOProvider:!1,ssoProviderID:void 0,ssoDisplayName:void 0,ssoProviders:void 0,workspaceID:void 0,firebaseProviders:[],hasEmailPassword:!1,recommendedProvider:void 0};return a(e),e}finally{r(!1)}},[]),isChecking:e,authProvider:t,setAuthProvider:a}}}}]);